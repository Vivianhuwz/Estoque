<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>库存销售管理系统</title>
  
  <!-- PWA 配置 -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#5d9cec">
  <meta name="description" content="专业的库存销售管理系统，支持库存管理、采购记录、销售分析等功能">
  
  <!-- 移动端优化 -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="库存管理">
  
  <!-- 图标配置 -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%235d9cec'/%3E%3Ctext x='50' y='50' font-size='40' text-anchor='middle' dy='0.35em' fill='white'%3E库%3C/text%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%235d9cec'/%3E%3Ctext x='50' y='50' font-size='40' text-anchor='middle' dy='0.35em' fill='white'%3E库%3C/text%3E%3C/svg%3E">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Microsoft+YaHei:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- 添加XLSX库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- 添加Chart.js库 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- 添加Chart.js datalabels插件 -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <!-- 添加Git存储系统 -->
  <script src="./js/git-storage.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#5d9cec',
            'light-blue': '#f0f8ff',
            'card-bg': '#ffffff',
            'hover-blue': '#4a89dc',
            'pressed-blue': '#3a7bd5',
          },
          fontFamily: {
            'microsoft': ['Microsoft YaHei', 'Arial', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background-color: #f0f8ff;
      color: #2c3e50;
    }
    
    /* 备份字体样式刷新 */
    .fallback-font {
      font-family: Arial, sans-serif;
      color: #34495e;
      background-color: #ecf0f1;
      padding: 2px 4px;
      border-radius: 3px;
    }
    
    .nav-item {
      transition: all 0.3s ease;
    }
    
    .nav-item:hover {
      background-color: #e6f2ff;
      transform: translateX(5px);
    }
    
    .nav-item.active {
      background-color: white;
      border-left: 4px solid #3a7bd5;
    }
    
    /* 根据图标颜色设置对应的active状态颜色 */
    #nav-inventory.active {
      color: #3b82f6; /* blue-500 */
      border-left-color: #3b82f6;
    }
    
    #nav-purchase.active {
      color: #10b981; /* green-500 */
      border-left-color: #10b981;
    }
    
    #nav-sales.active {
      color: #f97316; /* orange-500 */
      border-left-color: #f97316;
    }
    
    #nav-lowstock.active {
      color: #ef4444; /* red-500 */
      border-left-color: #ef4444;
    }
    
    #nav-analysis.active {
      color: #8b5cf6; /* purple-500 */
      border-left-color: #8b5cf6;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    
    .card:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }
    
    .btn-primary {
      background-color: #5d9cec;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background-color: #4a89dc;
    }
    
    .btn-primary:active {
      background-color: #3a7bd5;
    }
    
    .table-header {
      background-color: #5d9cec;
      color: white;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .table-row:hover {
      background-color: #f5f5f5;
    }
    
    .search-input {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 6px 12px;
      background: white;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #5d9cec;
      box-shadow: 0 0 0 2px rgba(93, 156, 236, 0.2);
    }
    
    /* 下拉框样式 */
    select.search-input {
      background-image: none;
      padding-right: 2rem;
    }
    
    select.search-input::-ms-expand {
      display: none;
    }
    
    .stats-card {
      background: linear-gradient(135deg, #5d9cec 0%, #4a89dc 100%);
      color: white;
    }
  </style>
</head>

<body class="bg-light-blue text-gray-800 min-h-screen flex">
  <!-- 左侧导航栏 -->
  <aside class="w-64 bg-white shadow-lg min-h-screen flex flex-col">
    <!-- Logo区域 -->
    <div class="p-6 border-b border-gray-200">
      <div class="flex items-center space-x-3">
        <div class="w-12 h-12 rounded-lg bg-white flex items-center justify-center">
          <i class="fa fa-cubes text-xl text-blue-500"></i>
        </div>
        <div>
          <h1 class="text-lg font-semibold text-gray-800">库存销售管理系统</h1>
          <p class="text-xs text-gray-500">Gestão de estoque</p>
        </div>
      </div>
    </div>
    
    <!-- 导航菜单 -->
    <nav class="flex-1 p-4">
      <ul class="space-y-2">
        <!-- 库存信息 -->
        <li>
          <a href="#" onclick="showTab('inventory')" id="nav-inventory" class="nav-item active flex items-center px-4 py-3 text-sm font-medium rounded-lg">
            <i class="fa fa-archive mr-3 text-lg text-blue-500"></i>
            <span>库存信息</span>
          </a>
        </li>
        
        <!-- 采购记录 -->
        <li>
          <a href="#" onclick="showTab('purchase')" id="nav-purchase" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
            <i class="fa fa-shopping-cart mr-3 text-lg text-green-500"></i>
            <span>采购记录</span>
          </a>
        </li>
        
        <!-- 销售记录 -->
        <li>
          <a href="#" onclick="showTab('sales')" id="nav-sales" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
            <i class="fa fa-line-chart mr-3 text-lg text-orange-500"></i>
            <span>销售记录</span>
          </a>
        </li>
        
        <!-- 低库存 -->
        <li>
          <a href="#" onclick="showTab('lowstock')" id="nav-lowstock" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
            <i class="fa fa-exclamation-triangle mr-3 text-lg text-red-500"></i>
            <span>低库存</span>
          </a>
        </li>
        
        <!-- 数据分析 -->
        <li>
          <a href="#" onclick="showTab('analysis')" id="nav-analysis" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
            <i class="fa fa-bar-chart mr-3 text-lg text-purple-500"></i>
            <span>数据分析</span>
          </a>
        </li>
        
        <!-- Git管理 -->
        <li>
          <a href="#" onclick="showTab('git')" id="nav-git" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-600 rounded-lg">
            <i class="fa fa-code-fork mr-3 text-lg text-indigo-500"></i>
            <span>版本管理</span>
          </a>
        </li>
      </ul>
    </nav>
    
    <!-- 底部操作区域 -->
    <div class="p-4 border-t border-gray-200">
      <!-- 移除导入Excel按钮，已移至顶部工具栏 -->
    </div>
  </aside>

  <!-- 右侧主要内容区域 -->
  <div class="flex-1 flex flex-col">
    <!-- 顶部工具栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
      <div class="px-6">
        <div class="flex items-center justify-between h-16">
          <!-- 页面标题 -->
          <div>
            <h1 class="text-xl font-semibold text-gray-800" id="pageTitle">库存信息</h1>
          </div>
          
          <!-- 搜索区域 -->
          <div class="flex-1 flex justify-center mx-8">
            <div class="flex space-x-3 w-96">
              <!-- 产品搜索框 -->
              <div class="relative flex-1">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fa fa-search text-gray-400"></i>
                </div>
                <input type="text" id="searchInput" placeholder="搜索产品..." 
                  class="w-full pl-10 pr-10 py-2 search-input"
                  oninput="searchProducts()">
                <button id="clearSearchBtn" onclick="clearSearch()" 
                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600" 
                        style="display: none;">
                  <i class="fa fa-times"></i>
                </button>
              </div>
              
              <!-- 类别筛选下拉框 -->
              <div class="relative">
                <select id="categoryFilter" class="search-input pr-8 appearance-none cursor-pointer" onchange="searchProducts()">
                  <option value="">所有类别</option>
                </select>
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                  <i class="fa fa-chevron-down text-gray-400 text-sm"></i>
                </div>
              </div>
            </div>
          </div>
          

          
          <!-- 操作按钮 -->
          <div class="flex space-x-3 ml-6">
            <button onclick="openUploadModal()" class="px-4 py-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors">
              <i class="fa fa-upload mr-2"></i>导入Excel
            </button>

            <button onclick="refreshData()" class="px-4 py-2 bg-orange-100 text-orange-600 rounded-lg hover:bg-orange-200 transition-colors">
              <i class="fa fa-refresh mr-2"></i>刷新
            </button>
            
            <!-- 存储管理按钮组 -->
            <div class="flex items-center space-x-2 border-l border-gray-300 pl-3">
              <!-- 同步状态显示 -->
              <div class="flex items-center space-x-2">
                <span id="syncStatus" class="text-sm text-gray-500">未同步</span>
                <div id="syncIndicator" class="w-2 h-2 bg-gray-400 rounded-full"></div>
              </div>
              
              <!-- 手动同步按钮 -->
              <button onclick="manualSync()" id="syncBtn" class="px-3 py-2 bg-purple-100 text-purple-600 rounded-lg hover:bg-purple-200 transition-colors text-sm">
                <i class="fa fa-cloud mr-1"></i>同步
              </button>
              
              <!-- 备份按钮 -->
              <button onclick="exportBackup()" class="px-3 py-2 bg-orange-100 text-orange-600 rounded-lg hover:bg-orange-200 transition-colors text-sm">
                <i class="fa fa-save mr-1"></i>备份
              </button>
              
              <!-- 恢复按钮 -->
              <button onclick="openRestoreModal()" class="px-3 py-2 bg-yellow-100 text-yellow-600 rounded-lg hover:bg-yellow-200 transition-colors text-sm">
                <i class="fa fa-undo mr-1"></i>恢复
              </button>
              
              <!-- 清除数据按钮 -->
              <button onclick="confirmClearData()" class="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors text-sm">
                <i class="fa fa-trash mr-1"></i>清除
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="flex-1 px-6 py-6">
      <!-- 统计面板 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- 总产品数 -->
        <div class="card p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-500 mb-1">总产品数</p>
              <p class="text-2xl font-bold text-gray-800" id="totalProducts">0</p>
            </div>
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
              <i class="fa fa-cubes text-xl text-blue-600"></i>
            </div>
          </div>
        </div>

        <!-- 低库存警告 -->
        <div class="card p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-500 mb-1">低库存警告</p>
              <p class="text-2xl font-bold text-red-600" id="lowStockCount">0</p>
            </div>
            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
              <i class="fa fa-exclamation-triangle text-xl text-red-600"></i>
            </div>
          </div>
        </div>

        <!-- 高库存警告 -->
        <div class="card p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-500 mb-1">高库存警告</p>
              <p class="text-2xl font-bold text-blue-600" id="highStockCount">0</p>
            </div>
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
              <i class="fa fa-arrow-up text-xl text-blue-600"></i>
            </div>
          </div>
        </div>

        <!-- 总库存箱数 -->
        <div class="card p-6">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-500 mb-1">总库存箱数</p>
              <p class="text-2xl font-bold text-green-600" id="totalStock">0</p>
            </div>
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
              <i class="fa fa-archive text-xl text-green-600"></i>
            </div>
          </div>
        </div>


      </div>

      <!-- 内容标签页 -->
      <div class="bg-white rounded-xl shadow-sm overflow-hidden">
        <!-- 库存信息标签页 -->
        <div id="inventory-tab" class="tab-content">
          <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800">库存信息</h2>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="table-header">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">产品名称</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">库存箱数</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">库存数量</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">进货箱数</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">已售箱数</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">出售数量</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">类别</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200" id="inventoryTableBody">
                <!-- 数据将通过JavaScript动态加载 -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- 采购记录标签页 -->
        <div id="purchase-tab" class="tab-content hidden">
          <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800">采购记录</h2>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="table-header">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">产品名称</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">进货箱数</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">总进货量</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">NF</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">货柜数量</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">货柜箱数</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">到货日期</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">类别</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200" id="purchaseTableBody">
                <!-- 数据将通过JavaScript动态加载 -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- 销售记录标签页 -->
        <div id="sales-tab" class="tab-content hidden">
          <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800">销售记录</h2>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="table-header">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">产品名称</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">已售箱数</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">出售数量</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">出售百分比</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">7天销售</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">30天销售</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">类别</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200" id="salesTableBody">
                <!-- 数据将通过JavaScript动态加载 -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- 低库存标签页 -->
        <div id="lowstock-tab" class="tab-content hidden">
          <div class="p-6 border-b border-gray-100 flex justify-between items-center">
            <div>
              <h2 class="text-xl font-semibold text-gray-800">低库存警告</h2>
              <p class="text-sm text-gray-500 mt-1">库存箱数低于5的产品</p>
            </div>
            <button onclick="exportLowStockData()" class="px-4 py-2 bg-green-100 text-green-600 rounded-lg hover:bg-green-200 transition-colors text-sm">
              <i class="fa fa-file-excel-o mr-2"></i>导出Excel
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="table-header">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">产品名称</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">库存箱数</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">价格</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">7天销售</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">30天销售</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase">类别</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200" id="lowStockTableBody">
                <!-- 数据将通过JavaScript动态加载 -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- 数据分析标签页 -->
        <div id="analysis-tab" class="tab-content hidden">
          <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800">数据分析</h2>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- 库存进销对比图 -->
              <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">库存进销对比</h3>
                <div style="height: 300px; width: 100%;">  <!-- 添加固定高度的容器 -->
                  <canvas id="inventoryComparisonChart"></canvas>
                </div>
              </div>
              
              <!-- 修改销售趋势图容器样式 -->
              <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">销售趋势</h3>
                <div style="height: 300px; width: 100%;">  <!-- 添加固定高度的容器 -->
                  <canvas id="salesChart"></canvas>
                </div>
              </div>
              
              <!-- 补货建议 -->
              <div class="card p-6 lg:col-span-2">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">补货建议</h3>
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="table-header">
                      <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase">产品名称</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase">库存箱数</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase">进货箱数</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase">库存数量</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase">已售箱数</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase">7天销售</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase">周转率</th>
                        <th class="px-6 py-3 text-left text-xs font-medium uppercase cursor-pointer hover:bg-blue-600 transition-colors duration-200" onclick="toggleSuggestionFilter()">
                          <div class="flex items-center justify-between">
                            <span>建议</span>
                            <i class="fa fa-chevron-down text-xs ml-2" id="suggestionFilterIcon"></i>
                          </div>
                        </th>
                      </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200" id="suggestionsTableBody">
                      <!-- 数据将通过JavaScript动态加载 -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Git管理标签页 -->
        <div id="git-tab" class="tab-content hidden">
          <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-800">版本管理</h2>
            <p class="text-sm text-gray-600 mt-1">管理数据版本和提交历史</p>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- 仓库状态 -->
              <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">仓库状态</h3>
                <div id="gitStatus" class="space-y-3">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600">当前分支:</span>
                    <span id="currentBranch" class="font-medium">main</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600">总提交数:</span>
                    <span id="totalCommits" class="font-medium">0</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600">最后提交:</span>
                    <span id="lastCommitTime" class="font-medium text-sm">无</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-600">数据大小:</span>
                    <span id="dataSize" class="font-medium">0 KB</span>
                  </div>
                </div>
                <div class="mt-4 space-y-2">
                  <button onclick="createManualCommit()" class="w-full btn-primary rounded-lg">
                    <i class="fa fa-save mr-2"></i>手动提交
                  </button>
                  <button onclick="exportGitRepo()" class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                    <i class="fa fa-download mr-2"></i>导出仓库
                  </button>
                </div>
              </div>
              
              <!-- 提交历史 -->
              <div class="card p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">提交历史</h3>
                <div id="commitHistory" class="space-y-3 max-h-80 overflow-y-auto">
                  <!-- 提交记录将通过JavaScript动态加载 -->
                </div>
              </div>
              
              <!-- 版本对比 -->
              <div class="card p-6 lg:col-span-2">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">版本对比</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">选择版本A:</label>
                    <select id="versionA" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                      <option value="">选择版本...</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">选择版本B:</label>
                    <select id="versionB" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                      <option value="">选择版本...</option>
                    </select>
                  </div>
                </div>
                <button onclick="compareVersions()" class="btn-primary rounded-lg mb-4">
                  <i class="fa fa-exchange mr-2"></i>对比版本
                </button>
                <div id="versionDiff" class="bg-gray-50 rounded-lg p-4 min-h-32">
                  <p class="text-gray-500 text-center">选择两个版本进行对比</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- 文件上传模态框 -->
  <div id="uploadModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-96">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">导入Excel文件</h3>
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
        <i class="fa fa-upload text-4xl text-gray-400 mb-4"></i>
        <p class="text-gray-600 mb-4">拖拽Excel文件到此处或点击选择文件</p>
        <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden" onchange="handleExcelUpload(event)">
        <button onclick="document.getElementById('fileInput').click()" class="btn-primary rounded-lg">
          选择文件
        </button>
      </div>
      <div class="flex justify-end space-x-3 mt-6">
        <button onclick="closeUploadModal()" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
          取消
        </button>
      </div>
    </div>
  </div>

  <script>
    // 全局变量
    let inventoryData = [];
    let currentTab = 'inventory';
    
    // 标签页切换
    function showTab(tabName) {
      // 隐藏所有标签页
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });
      
      // 显示选中的标签页
      document.getElementById(tabName + '-tab').classList.remove('hidden');
      
      // 更新导航状态
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        item.classList.add('text-gray-600');
      });
      
      document.getElementById('nav-' + tabName).classList.add('active');
      document.getElementById('nav-' + tabName).classList.remove('text-gray-600');
      
      // 更新页面标题
      const titles = {
        'inventory': { title: '库存信息', subtitle: '管理您的库存数据' },
        'purchase': { title: '采购记录', subtitle: '查看采购历史记录' },
        'sales': { title: '销售记录', subtitle: '分析销售数据' },
        'lowstock': { title: '低库存警告', subtitle: '库存箱数低于5的产品' },
        'analysis': { title: '数据分析', subtitle: '深度数据分析和报告' },
        'git': { title: '版本管理', subtitle: '管理数据版本和提交历史' }
      };
      
      document.getElementById('pageTitle').textContent = titles[tabName].title;
      
      // 如果切换到git标签页，更新Git状态
      if (tabName === 'git') {
        setTimeout(() => {
          updateGitStatus();
        }, 100);
      }
      
      currentTab = tabName;
    }
    
    // 加载Excel文件
    function loadExcelFile() {
      // 这个函数现在为空，或者可以删除
    }
    
    // 打开上传模态框
    function openUploadModal() {
      const modal = document.getElementById('uploadModal');
      if (modal) {
        modal.classList.remove('hidden');
      } else {
        console.error('找不到uploadModal元素');
      }
    }
    
    // 关闭上传模态框
    function closeUploadModal() {
      const modal = document.getElementById('uploadModal');
      const fileInput = document.getElementById('fileInput');
      
      if (modal) {
        modal.classList.add('hidden');
      }
      
      if (fileInput) {
        fileInput.value = '';
      }
    }
    
    // 处理Excel文件上传
    function handleExcelUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            // 检查XLSX库是否加载
            if (typeof XLSX === 'undefined') {
              alert('Excel处理库未加载，请刷新页面重试。如果问题持续存在，请检查网络连接。');
              return;
            }
            
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            inventoryData = jsonData;
            updateAllTables();
            updateStatistics();
            closeUploadModal();
            
            alert('Excel文件导入成功！');
          } catch (error) {
            console.error('Excel文件处理错误:', error);
            alert('文件解析失败：' + error.message + '\n请确保文件格式正确，或尝试重新保存为标准Excel格式。');
          }
        };
        reader.readAsArrayBuffer(file);
      }
    }
    
    // 更新所有表格
    function updateAllTables() {
      updateInventoryTable();
      updatePurchaseTable();
      updateSalesTable();
      updateLowStockTable();
      updateAnalysisTable();
    }
    
    // 更新库存表格
    function updateInventoryTable() {
      const tbody = document.getElementById('inventoryTableBody');
      tbody.innerHTML = '';
      
      inventoryData.forEach(item => {
        const stockCount = item['库存箱数'] || 0;
        const isLowStock = stockCount < 3;
        const stockColorClass = isLowStock ? 'text-red-600 font-bold' : 'text-gray-800';
        const productNameClass = isLowStock ? 'px-6 py-4 text-sm text-gray-800' : 'px-6 py-4 text-sm text-gray-800';
        const productNameStyle = isLowStock ? 'display: inline-block; padding: 2px 8px; background-color: #fce7f3; color: #dc2626; font-weight: bold; border-radius: 6px;' : '';
        
        // 计算库存数量（库存箱数 × 装箱数）
        const packingQty = item['装箱数'] || 1;
        const stockQuantity = stockCount * packingQty;
        
        const row = document.createElement('tr');
        row.className = 'table-row';
        row.innerHTML = `
          <td class="${productNameClass}"><span style="${productNameStyle}">${item['Apelido Produto'] || ''}</span></td>
          <td class="px-6 py-4 text-sm ${stockColorClass}">${stockCount}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${stockQuantity}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${item['进货箱数'] || 0}</td>
          <td class="px-6 py-4 text-sm text-gray-800 font-bold">${item['已售箱数'] || 0}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${item['出售数量'] || 0}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${item['类别'] || '产品'}</td>
        `;
        tbody.appendChild(row);
      });
    }
    
    // 更新采购表格
    // 更新采购表格 - 参考Python版本的复杂逻辑
    function updatePurchaseTable() {
      const tbody = document.getElementById('purchaseTableBody');
      tbody.innerHTML = '';
      
      inventoryData.forEach(item => {
        const product = item['Apelido Produto'] || '';
        const packingQty = item['装箱数'] || 1;
        const category = item['类别'] || item['Category'] || item['Categoria'] || item['CATEGORIA'] || item['产品类别'] || item['产品分类'] || '产品';
        
        // 检查是否有进货量数据
        const purchaseQty = item['进货量'] || 0;
        if (purchaseQty <= 0) return;
        
        // 处理多个NF、货柜数量、到货日期的情况
        const nfField = item['NF'] || '';
        if (nfField && typeof nfField === 'string' && nfField.includes(',')) {
          // 拆分多个记录
          const nfValues = nfField.split(',').map(v => v.trim());
          const containerValues = (item['各个货柜数量'] || '').toString().split(',').map(v => v.trim());
          const dateValues = (item['到货日期'] || '').toString().split(',').map(v => v.trim());
          
          const maxLen = Math.max(nfValues.length, containerValues.length, dateValues.length);
          
          for (let i = 0; i < maxLen; i++) {
            const nf = i < nfValues.length ? nfValues[i] : '';
            const container = i < containerValues.length ? containerValues[i] : '';
            const date = i < dateValues.length ? dateValues[i] : '';
            
            // 计算货柜箱数
            let containerBoxes = 0;
            try {
              if (container && packingQty > 0) {
                containerBoxes = Math.floor(parseFloat(container) / packingQty);
              }
            } catch (e) {
              containerBoxes = 0;
            }
            
            const stock = item['库存箱数'] || 0;
            const productNameStyle = stock < 5 ? 
              `<span style="display: inline-block; padding: 2px 8px; background-color: #fce7f3; color: #dc2626; font-weight: bold; border-radius: 6px;">${product}</span>` : 
              product;
            
            const row = document.createElement('tr');
            row.className = 'table-row';
            row.innerHTML = `
              <td class="px-6 py-4 text-sm text-gray-800">${productNameStyle}</td>
              <td class="px-6 py-4 text-sm text-gray-800">${((item['进货箱数'] || 0) / maxLen).toFixed(1)}</td>
              <td class="px-6 py-4 text-sm text-gray-800">${item['总进货量'] || 0}</td>
              <td class="px-6 py-4 text-sm text-gray-800">${nf}</td>
              <td class="px-6 py-4 text-sm text-gray-800">${container}</td>
              <td class="px-6 py-4 text-sm text-gray-800">${containerBoxes}</td>
              <td class="px-6 py-4 text-sm text-gray-800">${date}</td>
              <td class="px-6 py-4 text-sm text-gray-800">${category}</td>
            `;
            tbody.appendChild(row);
          }
        } else {
          // 单个记录的情况
          const container = item['各个货柜数量'] || '';
          let containerBoxes = 0;
          try {
            if (container && packingQty > 0) {
              containerBoxes = parseFloat(container) / packingQty;
            }
          } catch (e) {
            containerBoxes = 0;
          }
          
          const stock = item['库存箱数'] || 0;
          const productNameStyle = stock < 5 ? 
            `<span style="display: inline-block; padding: 2px 8px; background-color: #fce7f3; color: #dc2626; font-weight: bold; border-radius: 6px;">${product}</span>` : 
            product;
          
          const row = document.createElement('tr');
          row.className = 'table-row';
          row.innerHTML = `
            <td class="px-6 py-4 text-sm text-gray-800">${productNameStyle}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['进货箱数'] || 0}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['总进货量'] || 0}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${nfField}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${container}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${containerBoxes.toFixed(1)}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['到货日期'] || ''}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${category}</td>
          `;
          tbody.appendChild(row);
        }
      });
    }
    
    // 更新销售表格
    function updateSalesTable() {
      const tbody = document.getElementById('salesTableBody');
      tbody.innerHTML = '';
      
      inventoryData.forEach(item => {
        if (item['出售数量'] > 0) {
          const row = document.createElement('tr');
          row.className = 'table-row';
          row.innerHTML = `
            <td class="px-6 py-4 text-sm text-gray-800">${item['Apelido Produto'] || ''}</td>
            <td class="px-6 py-4 text-sm text-gray-800 font-bold">${item['已售箱数'] || 0}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['出售数量'] || 0}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['%出售'] || '0%'}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['Vendas 7 dias'] || 0}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['Vendas 30 dias'] || 0}</td>
            <td class="px-6 py-4 text-sm text-gray-800">${item['类别'] || '产品'}</td>
          `;
          tbody.appendChild(row);
        }
      });
    }
    

    
    // 更新低库存表格
    function updateLowStockTable() {
      const tbody = document.getElementById('lowStockTableBody');
      tbody.innerHTML = '';
      
      // 筛选库存箱数小于5的产品
      const lowStockItems = inventoryData.filter(item => (item['库存箱数'] || 0) < 5);
      
      lowStockItems.forEach(item => {
        const stock = item['库存箱数'] || 0;
        const sales7d = item['Vendas 7 dias'] || 0;
        const sales30d = item['Vendas 30 dias'] || 0;
        
        const row = document.createElement('tr');
        row.className = 'table-row';
        row.innerHTML = `
          <td class="px-6 py-4 text-sm text-gray-800">
            <span style="display: inline-block; padding: 2px 8px; background-color: #ffffff; color: #000000; border-radius: 6px;">${item['Apelido Produto'] || ''}</span>
          </td>
          <td class="px-6 py-4 text-sm text-red-600 font-bold">${stock}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${item['Preco'] || 0}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${sales7d}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${sales30d}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${item['类别'] || '产品'}</td>
        `;
        tbody.appendChild(row);
      });
    }
    
    // 更新统计数据
    function updateStatistics() {
      const totalProducts = inventoryData.length;
      const lowStockCount = inventoryData.filter(item => (item['库存箱数'] || 0) < 5).length;
      const highStockCount = inventoryData.filter(item => (item['库存箱数'] || 0) > 20).length;
      const totalStock = inventoryData.reduce((sum, item) => sum + (item['库存箱数'] || 0), 0);
      
      document.getElementById('totalProducts').textContent = totalProducts;
      document.getElementById('lowStockCount').textContent = lowStockCount;
      document.getElementById('highStockCount').textContent = highStockCount;
      document.getElementById('totalStock').textContent = totalStock;
    }
    
    // 更新类别下拉选项
    function updateCategoryOptions() {
      const categorySelect = document.getElementById('categoryFilter');
      const categories = new Set();
      
      // 收集所有类别
      inventoryData.forEach(item => {
        const category = item['类别'] || item['Category'] || item['Categoria'] || item['CATEGORIA'] || item['产品类别'] || item['产品分类'] || '产品';
        if (category && category.trim()) {
          categories.add(category.trim());
        }
      });
      
      // 清空现有选项（保留"所有类别"）
      categorySelect.innerHTML = '<option value="">所有类别</option>';
      
      // 添加类别选项
      Array.from(categories).sort().forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        categorySelect.appendChild(option);
      });
    }
    
    // 搜索产品（修改后的版本）
    function searchProducts() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const selectedCategory = document.getElementById('categoryFilter').value;
      const rows = document.querySelectorAll('.table-row');
      
      // 显示/隐藏清除按钮
      const clearBtn = document.getElementById('clearSearchBtn');
      if (searchTerm || selectedCategory) {
        clearBtn.style.display = 'flex';
      } else {
        clearBtn.style.display = 'none';
      }
      
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (cells.length === 0) return;
        
        const productName = cells[0].textContent.toLowerCase();
        const categoryCell = cells[cells.length - 1]; // 类别通常在最后一列
        const category = categoryCell ? categoryCell.textContent.trim() : '';
        
        // 检查产品名称匹配
        const nameMatches = !searchTerm || productName.includes(searchTerm);
        
        // 检查类别匹配
        const categoryMatches = !selectedCategory || category === selectedCategory;
        
        // 显示或隐藏行
        if (nameMatches && categoryMatches) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
      
      // 更新图表，传递搜索词
      const originalSearchTerm = document.getElementById('searchInput').value;
      updateCharts(originalSearchTerm || null);
    }
    
    // 清除搜索
    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('clearSearchBtn').style.display = 'none';
      
      // 显示所有行
      const rows = document.querySelectorAll('.table-row');
      rows.forEach(row => {
        row.style.display = '';
      });
      
      // 更新图表，不传递任何过滤条件
      updateCharts(null);
    }
    

    
    // 获取销售趋势数据
    function getSalesTrend() {
      const sales7d = inventoryData.reduce((sum, item) => sum + (item['Vendas 7 dias'] || 0), 0);
      const sales30d = inventoryData.reduce((sum, item) => sum + (item['Vendas 30 dias'] || 0), 0);
      const weeklyAvg = sales30d / 4;
      
      return {
        '7天销售': sales7d,
        '周平均': weeklyAvg,
        '30天销售': sales30d
      };
    }
    
    // 获取库存进销对比数据
    function getInventoryComparisonData(productFilter = null) {
      // 根据产品名称筛选数据
      let filteredData = inventoryData;
      if (productFilter) {
        filteredData = inventoryData.filter(item => {
          const productName = item['Apelido Produto'] || '';
          return productName.toLowerCase().includes(productFilter.toLowerCase());
        });
      }
      
      // 始终按产品型号分组
      const groupData = {};
      
      filteredData.forEach(item => {
        // 使用产品型号作为分组键
        const groupKey = item['Apelido Produto'] || '未知产品';
        
        // 如果是第一次遇到这个产品型号，初始化数据
        if (!groupData[groupKey]) {
          groupData[groupKey] = {
            '仓库箱数': 0,
            '进货箱数': 0,
            '已售箱数': 0
          };
        }
        
        // 累加数据
        groupData[groupKey]['仓库箱数'] += (item['库存箱数'] || 0);
        groupData[groupKey]['进货箱数'] += (item['进货箱数'] || 0);
        groupData[groupKey]['已售箱数'] += (item['已售箱数'] || 0);
      });
      
      return groupData;
    }
    
    // 更新图表
    function updateCharts(productFilter = null) {
      // 销售趋势柱状图
      const salesTrend = getSalesTrend();
      const salesCtx = document.getElementById('salesChart');
      
      if (window.salesChart instanceof Chart) {
        window.salesChart.destroy();
      }
      
      window.salesChart = new Chart(salesCtx, {
        type: 'bar',
        data: {
          labels: Object.keys(salesTrend),
          datasets: [{
            label: '销售量',
            data: Object.values(salesTrend),
            backgroundColor: '#5d9cec',
            borderColor: '#4a89dc',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,  // 修改为true
          plugins: {
            legend: {
              display: false
            },
            title: {
              display: true,
              text: '销售趋势分析'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '销售量'
              }
            }
          }
        }
      });
      
      // 库存进销对比图表
      const comparisonData = getInventoryComparisonData(productFilter);
      const comparisonCtx = document.getElementById('inventoryComparisonChart');
      
      if (window.inventoryComparisonChart instanceof Chart) {
        window.inventoryComparisonChart.destroy();
      }
      
      // 准备图表数据
      const categories = Object.keys(comparisonData);
      const stockData = [];
      const purchaseData = [];
      const soldData = [];
      
      categories.forEach(category => {
        stockData.push(comparisonData[category]['仓库箱数']);
        purchaseData.push(comparisonData[category]['进货箱数']);
        soldData.push(comparisonData[category]['已售箱数']);
      });
      
      window.inventoryComparisonChart = new Chart(comparisonCtx, {
        type: 'bar',
        plugins: [ChartDataLabels],
        data: {
          labels: categories,
          datasets: [
            {
              label: '仓库箱数',
              data: stockData,
              backgroundColor: '#4ecdc4',
              borderColor: '#2ecc71',
              borderWidth: 1,
              stack: 'stack1'
            },
            {
              label: '进货箱数',
              data: purchaseData,
              backgroundColor: '#5d9cec',
              borderColor: '#4a89dc',
              borderWidth: 1,
              stack: 'stack1'
            },
            {
              label: '已售箱数',
              data: soldData,
              backgroundColor: '#ff69b4',
              borderColor: '#e91e63',
              borderWidth: 1,
              stack: 'stack1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              position: 'top'
            },
            title: {
              display: false
            },
            datalabels: {
              display: true,
              color: 'white',
              font: {
                weight: 'bold',
                size: 12
              },
              formatter: function(value, context) {
                return value > 0 ? value : '';
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              stacked: true,
              title: {
                display: true,
                text: '箱数'
              }
            },
            x: {
              stacked: true,
              title: {
                display: false
              }
            }
          }
        }
      });
    }
    
    // 更新分析表格（补货建议）
    function updateAnalysisTable() {
      const tbody = document.getElementById('suggestionsTableBody');
      tbody.innerHTML = '';
      
      inventoryData.forEach(item => {
        const stock = item['库存箱数'] || 0;
        const sales7d = item['Vendas 7 dias'] || 0;
        let turnover = 0;
        
        if (stock > 0) {
          turnover = sales7d / stock;
        }
        
        let suggestion = '库存正常';
        let suggestionClass = 'bg-green-100 text-green-600';
        
        // 修改建议逻辑：先判断库存是否过多，再判断是否需要补货
        if (stock < 5) {
          // 库存低于5箱，无论销售如何都建议紧急补货
          suggestion = '紧急补货';
          suggestionClass = 'bg-red-100 text-red-600';
        } else if (stock > 30 && turnover < 0.1) {
          // 库存超过30箱且周转率低于0.1，判定为库存过多
          suggestion = '库存过多';
          suggestionClass = 'bg-blue-100 text-blue-600';
        } else if (turnover > 0.5) {
          // 周转率高于0.5，建议补货
          suggestion = '建议补货';
          suggestionClass = 'bg-yellow-100 text-yellow-600';
        }
        
        // 设置产品名称样式：库存箱数低于3时显示粉色底红色字
        const productNameStyle = stock < 3 ? 
          `<span style="display: inline-block; padding: 2px 8px; background-color: #fce7f3; color: #dc2626; font-weight: bold; border-radius: 6px;">${item['Apelido Produto'] || ''}</span>` : 
          (item['Apelido Produto'] || '');
        
        const row = document.createElement('tr');
        row.className = 'table-row';
        row.innerHTML = `
          <td class="px-6 py-4 text-sm text-gray-800">${productNameStyle}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${stock}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${item['进货箱数'] || 0}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${item['出售数量'] || 0}</td>
          <td class="px-6 py-4 text-sm text-gray-800 font-bold">${item['已售箱数'] || 0}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${sales7d}</td>
          <td class="px-6 py-4 text-sm text-gray-800">${turnover.toFixed(2)}</td>
          <td class="px-6 py-4 text-sm">
            <span class="px-2 py-1 text-xs rounded-full ${suggestionClass}">${suggestion}</span>
          </td>
        `;
        tbody.appendChild(row);
      });
    }
    
    // 更新所有表格（修改后的版本）
    function updateAllTables() {
      updateInventoryTable();
      updatePurchaseTable();
      updateSalesTable();
      updateLowStockTable();
      updateAnalysisTable();
      updateCategoryOptions();
      updateCharts(); // 添加图表更新
    }
    
    // 导出数据
    function exportData() {
      // 检查XLSX库是否加载
      if (typeof XLSX === 'undefined') {
        alert('Excel处理库未加载，无法导出文件。请刷新页面重试。');
        return;
      }
      
      if (inventoryData.length === 0) {
        alert('没有数据可导出');
        return;
      }
      
      try {
        const ws = XLSX.utils.json_to_sheet(inventoryData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, '库存数据');
        XLSX.writeFile(wb, '库存管理数据.xlsx');
      } catch (error) {
        console.error('导出失败:', error);
        alert('导出失败：' + error.message);
      }
    }
    
    // 导出低库存数据
    function exportLowStockData() {
      // 检查XLSX库是否加载
      if (typeof XLSX === 'undefined') {
        alert('Excel处理库未加载，无法导出文件。请刷新页面重试。');
        return;
      }
      
      // 筛选库存箱数小于5的产品
      const lowStockItems = inventoryData.filter(item => (item['库存箱数'] || 0) < 5);
      
      if (lowStockItems.length === 0) {
        alert('没有低库存产品可导出');
        return;
      }
      
      // 准备导出数据，使用中文列名
      const exportData = lowStockItems.map(item => ({
        '产品名称': item['Apelido Produto'] || '',
        '库存箱数': item['库存箱数'] || 0,
        '价格': item['Preco'] || 0,
        '7天销售': item['Vendas 7 dias'] || 0,
        '30天销售': item['Vendas 30 dias'] || 0,
        '类别': item['类别'] || '产品',
        '进货箱数': item['进货箱数'] || 0,
        '已售箱数': item['已售箱数'] || 0,
        '出售数量': item['出售数量'] || 0,
        '余额': item['(=) Saldo Final'] || 0
      }));
      
      try {
        // 创建工作表
        const ws = XLSX.utils.json_to_sheet(exportData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, '低库存警告');
        
        // 生成文件名（包含当前日期）
        const now = new Date();
        const dateStr = now.getFullYear() + '-' + 
                       String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                       String(now.getDate()).padStart(2, '0');
        const fileName = `低库存警告_${dateStr}.xlsx`;
        
        // 导出文件
        XLSX.writeFile(wb, fileName);
      } catch (error) {
        console.error('导出失败:', error);
        alert('导出失败：' + error.message);
      }
      
      alert(`低库存数据导出成功！\n文件名：${fileName}\n共导出 ${lowStockItems.length} 个低库存产品`);
    }
    
    // 刷新数据
    function refreshData() {
      updateAllTables();
      updateStatistics();
      alert('数据已刷新');
    }
    
    // 数据存储相关常量和变量
    const STORAGE_KEY = 'inventory_management_data';
    const CLOUD_API_URL = 'https://api.example.com/inventory'; // 替换为实际的云端API
    let isOnline = navigator.onLine;
    let lastSyncTime = null;
    let autoSaveInterval = null;
    
    // Git存储系统
    let gitStorage = null;
    
    // 初始化Git存储系统
    function initializeGitStorage() {
      try {
        gitStorage = new GitStorage();
        console.log('Git存储系统初始化成功');
        updateSyncStatus('Git存储已就绪', 'success');
        return true;
      } catch (error) {
        console.error('Git存储系统初始化失败:', error);
        updateSyncStatus('Git存储初始化失败', 'error');
        return false;
      }
    }

    // 监听网络状态变化
    window.addEventListener('online', () => {
      isOnline = true;
      updateSyncStatus('网络已连接，正在同步...', 'syncing');
      syncWithCloud();
    });

    window.addEventListener('offline', () => {
      isOnline = false;
      updateSyncStatus('离线模式，使用本地数据', 'warning');
      console.log('网络断开，系统将使用本地存储的数据继续工作');
    });

    // 从Git存储加载数据
    function loadFromLocalStorage() {
      try {
        // 优先从Git存储加载
        if (gitStorage) {
          const gitData = gitStorage.getData();
          if (gitData && (gitData.inventory || gitData.images)) {
            inventoryData = gitData.inventory || [];
            productImages = gitData.images || {};
            lastSyncTime = gitData.lastModified || null;
            console.log('数据已从Git存储加载');
            updateSyncStatus('Git数据已加载', 'success');
            return true;
          }
        }
        
        // 回退到传统本地存储
        const data = localStorage.getItem(STORAGE_KEY);
        if (data) {
          const parsedData = JSON.parse(data);
          inventoryData = parsedData.inventory || [];
          productImages = parsedData.images || {};
          lastSyncTime = parsedData.lastSync || null;
          console.log('数据已从本地存储加载');
          updateSyncStatus('本地数据已加载', 'success');
          return true;
        }
      } catch (error) {
        console.error('从存储加载数据失败:', error);
        updateSyncStatus('加载失败', 'error');
      }
      return false;
    }

    // 保存到存储系统
    function saveToLocalStorage() {
      try {
        const dataToSave = {
          inventory: inventoryData,
          images: productImages,
          lastSync: lastSyncTime,
          savedAt: new Date().toISOString()
        };
        
        // 保存到Git存储
        if (gitStorage) {
          gitStorage.saveData(dataToSave, false); // 不自动提交，避免过多提交
        }
        
        // 同时保存到传统本地存储作为备份
        localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
        console.log('数据已保存到存储系统');
        updateSyncStatus('数据已保存', 'success');
      } catch (error) {
        console.error('保存到本地存储失败:', error);
        updateSyncStatus('保存失败', 'error');
      }
    }

    // Git存储同步功能
    async function syncWithCloud() {
      if (!gitStorage) {
        updateSyncStatus('Git存储未初始化', 'error');
        return;
      }

      updateSyncStatus('正在同步到Git存储...', 'syncing');
      
      try {
        // 保存数据到Git存储系统
        const dataToSync = {
          inventory: inventoryData,
          images: productImages
        };
        
        const success = gitStorage.saveData(dataToSync, true);
        
        if (success) {
          // 创建提交
          const commitId = gitStorage.commit(
            `数据同步: ${inventoryData.length} 个库存项目`,
            'user'
          );
          
          if (commitId) {
            lastSyncTime = new Date().toISOString();
            updateSyncStatus(`Git同步成功 (${commitId.substring(0, 8)})`, 'success');
            
            // 显示Git状态信息
            const status = gitStorage.getStatus();
            console.log('Git仓库状态:', status);
          } else {
            throw new Error('创建Git提交失败');
          }
        } else {
          throw new Error('保存到Git存储失败');
        }
      } catch (error) {
        console.error('Git同步失败:', error);
        updateSyncStatus('Git同步失败，使用本地数据', 'error');
        
        // 确保在同步失败时，数据仍然可用
        if (inventoryData.length === 0) {
          loadFromLocalStorage();
        }
        
        // 显示用户友好的错误信息
        console.log('提示：系统将继续使用本地存储的数据，功能不受影响');
      }
    }

    // 更新同步状态显示
    function updateSyncStatus(message, type) {
      const statusElement = document.getElementById('syncStatus');
      const indicatorElement = document.getElementById('syncIndicator');
      
      if (statusElement) {
        statusElement.textContent = message;
        statusElement.className = `text-sm ${
          type === 'success' ? 'text-green-600' :
          type === 'error' ? 'text-red-600' :
          type === 'warning' ? 'text-yellow-600' :
          type === 'syncing' ? 'text-blue-600' :
          'text-gray-600'
        }`;
      }
      
      if (indicatorElement) {
        // 移除所有状态类
        indicatorElement.className = 'w-2 h-2 rounded-full';
        
        switch (type) {
          case 'success':
            indicatorElement.classList.add('bg-green-500');
            break;
          case 'error':
            indicatorElement.classList.add('bg-red-500');
            // 同步失败时，确保使用本地数据
            console.log('云端同步失败，使用本地数据');
            break;
          case 'warning':
            indicatorElement.classList.add('bg-yellow-500');
            break;
          case 'syncing':
            indicatorElement.classList.add('bg-blue-500', 'animate-pulse');
            break;
          default:
            indicatorElement.classList.add('bg-gray-400');
        }
      }
    }

    // 自动保存功能
    function startAutoSave() {
      if (autoSaveInterval) {
        clearInterval(autoSaveInterval);
      }
      
      autoSaveInterval = setInterval(() => {
        saveToLocalStorage();
        if (isOnline) {
          syncWithCloud();
        }
      }, 30000); // 每30秒自动保存
    }

    // 导出备份数据
    function exportBackup() {
      try {
        const backupData = {
          inventory: inventoryData,
          images: productImages,
          exportTime: new Date().toISOString(),
          version: '1.0'
        };
        
        const dataStr = JSON.stringify(backupData, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `inventory_backup_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        updateSyncStatus('备份已导出', 'success');
      } catch (error) {
        console.error('导出备份失败:', error);
        updateSyncStatus('导出失败', 'error');
      }
    }

    // 导入备份数据
    function importBackup(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const backupData = JSON.parse(e.target.result);
          
          if (backupData.inventory && Array.isArray(backupData.inventory)) {
            inventoryData = backupData.inventory;
            productImages = backupData.images || {};
            
            saveToLocalStorage();
            updateAllTables();
            updateStatistics();
            
            updateSyncStatus('备份已导入', 'success');
            alert('备份数据导入成功！');
          } else {
            throw new Error('无效的备份文件格式');
          }
        } catch (error) {
          console.error('导入备份失败:', error);
          updateSyncStatus('导入失败', 'error');
          alert('备份文件格式错误或损坏！');
        }
      };
      reader.readAsText(file);
    }

    // 清除所有数据
    function clearAllData() {
      if (confirm('确定要清除所有数据吗？此操作不可恢复！')) {
        localStorage.removeItem(STORAGE_KEY);
        inventoryData = [];
        productImages = {};
        lastSyncTime = null;
        
        updateAllTables();
        updateStatistics();
        updateSyncStatus('数据已清除', 'warning');
        alert('所有数据已清除！');
      }
    }

    // 应用初始化函数
    function initializeApp() {
      // 尝试从本地存储加载数据
      const hasLocalData = loadFromLocalStorage();
      
      // 如果没有本地数据，使用示例数据
      if (!hasLocalData) {
        inventoryData = [
        {
          'Apelido Produto': '示例产品A',
          '库存箱数': 15,
          '进货箱数': 20,
          '已售箱数': 5,
          '出售数量': 50,
          'Preco': 25.50,
          '(=) Saldo Final': 150,
          '类别': '电子产品',
          'Vendas 7 dias': 10,
          'Vendas 30 dias': 500
        },
        {
          'Apelido Produto': '示例产品B',
          '库存箱数': 2,
          '进货箱数': 10,
          '已售箱数': 8,
          '出售数量': 80,
          'Preco': 15.00,
          '(=) Saldo Final': 30,
          '类别': '家居用品',
          'Vendas 7 dias': 15,
          'Vendas 30 dias': 700
        },
        {
          'Apelido Produto': '低库存产品C',
          '库存箱数': 1,
          '进货箱数': 5,
          '已售箱数': 4,
          '出售数量': 40,
          'Preco': 8.99,
          '(=) Saldo Final': 10,
          '类别': '食品',
          'Vendas 7 dias': 8,
          'Vendas 30 dias': 320
        },
        {
          'Apelido Produto': 'MRES-B139',
          '库存箱数': 2,
          '进货箱数': 15,
          '已售箱数': 13,
          '出售数量': 130,
          'Preco': 18.50,
          '(=) Saldo Final': 37,
          '类别': '电子产品',
          'Vendas 7 dias': 5,
          'Vendas 30 dias': 260
        },
        {
          'Apelido Produto': '急需补货D',
          '库存箱数': 0,
          '进货箱数': 8,
          '已售箱数': 8,
          '出售数量': 80,
          'Preco': 12.75,
          '(=) Saldo Final': 0,
          '类别': '日用品',
          'Vendas 7 dias': 12,
          'Vendas 30 dias': 480
        }
      ];
      }
      
      updateAllTables();
      updateStatistics();
      
      // 启动自动保存
      startAutoSave();
      
      // 如果在线，尝试云端同步
      if (isOnline) {
        syncWithCloud();
      }
    }
    

    

    


    
    // 手动同步函数
    function manualSync() {
      if (!isOnline) {
        alert('当前离线，系统将继续使用本地数据');
        updateSyncStatus('离线模式，使用本地数据', 'warning');
        return;
      }
      
      const syncBtn = document.getElementById('syncBtn');
      const originalText = syncBtn.innerHTML;
      
      syncBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-1"></i>同步中...';
      syncBtn.disabled = true;
      
      updateSyncStatus('正在手动同步...', 'syncing');
      
      syncWithCloud().finally(() => {
        syncBtn.innerHTML = originalText;
        syncBtn.disabled = false;
      });
    }
    
    // 打开恢复模态框
    function openRestoreModal() {
      document.getElementById('restoreModal').classList.remove('hidden');
    }
    
    // 关闭恢复模态框
    function closeRestoreModal() {
      document.getElementById('restoreModal').classList.add('hidden');
      document.getElementById('restoreFileInput').value = '';
    }
    
    // 处理恢复文件选择
    function handleRestoreFile(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const backupData = JSON.parse(e.target.result);
            if (confirm('确定要恢复数据吗？这将覆盖当前所有数据。')) {
              importBackup(backupData);
            }
          } catch (error) {
            alert('备份文件格式错误，请选择有效的备份文件。');
          }
        };
        reader.readAsText(file);
      }
    }
    
    // 确认清除数据
    function confirmClearData() {
      if (confirm('确定要清除所有数据吗？此操作不可撤销。\n\n建议在清除前先进行数据备份。')) {
        if (confirm('再次确认：这将删除所有库存数据，确定继续吗？')) {
          clearAllData();
        }
      }
    }
    
    // 建议筛选功能
    let suggestionFilterOpen = false;
    let currentSuggestionFilter = '';
    
    function toggleSuggestionFilter() {
      const icon = document.getElementById('suggestionFilterIcon');
      
      if (!suggestionFilterOpen) {
        // 创建下拉筛选菜单
        const filterMenu = document.createElement('div');
        filterMenu.id = 'suggestionFilterMenu';
        filterMenu.className = 'absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 min-w-32';
        filterMenu.innerHTML = `
          <div class="p-2">
            <div class="cursor-pointer px-3 py-2 text-sm text-black hover:bg-gray-100 rounded" onclick="filterSuggestions('')">全部</div>
             <div class="cursor-pointer px-3 py-2 text-sm text-black hover:bg-gray-100 rounded" onclick="filterSuggestions('紧急补货')">紧急补货</div>
             <div class="cursor-pointer px-3 py-2 text-sm text-black hover:bg-gray-100 rounded" onclick="filterSuggestions('建议补货')">建议补货</div>
             <div class="cursor-pointer px-3 py-2 text-sm text-black hover:bg-gray-100 rounded" onclick="filterSuggestions('库存正常')">库存正常</div>
             <div class="cursor-pointer px-3 py-2 text-sm text-black hover:bg-gray-100 rounded" onclick="filterSuggestions('库存过多')">库存过多</div>
          </div>
        `;
        
        // 获取表头元素并设置相对定位
        const thElement = icon.closest('th');
        thElement.style.position = 'relative';
        thElement.appendChild(filterMenu);
        
        // 旋转箭头
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
        
        suggestionFilterOpen = true;
        
        // 点击外部关闭菜单
        setTimeout(() => {
          document.addEventListener('click', closeSuggestionFilter);
        }, 100);
      } else {
        closeSuggestionFilter();
      }
    }
    
    function closeSuggestionFilter() {
      const filterMenu = document.getElementById('suggestionFilterMenu');
      const icon = document.getElementById('suggestionFilterIcon');
      
      if (filterMenu) {
        filterMenu.remove();
      }
      
      if (icon) {
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
      }
      
      suggestionFilterOpen = false;
      document.removeEventListener('click', closeSuggestionFilter);
    }
    
    function filterSuggestions(filterValue) {
      currentSuggestionFilter = filterValue;
      const tbody = document.getElementById('suggestionsTableBody');
      const rows = tbody.querySelectorAll('tr');
      
      rows.forEach(row => {
        const suggestionCell = row.querySelector('td:last-child span');
        if (suggestionCell) {
          const suggestionText = suggestionCell.textContent.trim();
          if (!filterValue || suggestionText === filterValue) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        }
      });
      
      closeSuggestionFilter();
    }
    
    // Git管理相关函数
    function updateGitStatus() {
      if (!gitStorage) return;
      
      const status = gitStorage.getStatus();
      const config = gitStorage.getConfig();
      
      document.getElementById('currentBranch').textContent = config.currentBranch;
      document.getElementById('totalCommits').textContent = status.totalCommits;
      document.getElementById('lastCommitTime').textContent = status.lastCommit ? 
        new Date(status.lastCommit.timestamp).toLocaleString() : '无';
      document.getElementById('dataSize').textContent = (status.dataSize / 1024).toFixed(2) + ' KB';
      
      updateCommitHistory();
      updateVersionSelects();
    }
    
    function updateCommitHistory() {
      if (!gitStorage) return;
      
      const commits = gitStorage.getCommitHistory();
      const container = document.getElementById('commitHistory');
      
      if (commits.length === 0) {
        container.innerHTML = '<p class="text-gray-500 text-center">暂无提交记录</p>';
        return;
      }
      
      container.innerHTML = commits.slice(0, 10).map(commit => `
        <div class="border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors">
          <div class="flex justify-between items-start mb-2">
            <span class="font-medium text-sm text-gray-800">${commit.message}</span>
            <span class="text-xs text-gray-500">${commit.hash.substring(0, 8)}</span>
          </div>
          <div class="text-xs text-gray-600">
            ${new Date(commit.timestamp).toLocaleString()}
          </div>
          <div class="mt-2 flex space-x-2">
            <button onclick="revertToCommit('${commit.hash}')" class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded hover:bg-blue-200 transition-colors">
              恢复到此版本
            </button>
            <button onclick="viewCommitDetails('${commit.hash}')" class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded hover:bg-gray-200 transition-colors">
              查看详情
            </button>
          </div>
        </div>
      `).join('');
    }
    
    function updateVersionSelects() {
      if (!gitStorage) return;
      
      const commits = gitStorage.getCommitHistory();
      const versionASelect = document.getElementById('versionA');
      const versionBSelect = document.getElementById('versionB');
      
      const options = commits.map(commit => 
        `<option value="${commit.hash}">${commit.message} (${new Date(commit.timestamp).toLocaleDateString()})</option>`
      ).join('');
      
      versionASelect.innerHTML = '<option value="">选择版本...</option>' + options;
      versionBSelect.innerHTML = '<option value="">选择版本...</option>' + options;
    }
    
    function createManualCommit() {
      if (!gitStorage) {
        alert('Git存储系统未初始化');
        return;
      }
      
      const message = prompt('请输入提交信息:', '手动提交 - ' + new Date().toLocaleString());
      if (!message) return;
      
      try {
        const data = {
          inventory: inventoryData,
          images: imageData
        };
        
        gitStorage.commit(data, message);
        updateGitStatus();
        alert('提交成功!');
      } catch (error) {
        console.error('提交失败:', error);
        alert('提交失败: ' + error.message);
      }
    }
    
    function revertToCommit(commitHash) {
      if (!gitStorage) return;
      
      if (!confirm('确定要恢复到此版本吗？当前未保存的更改将丢失。')) {
        return;
      }
      
      try {
        const data = gitStorage.revertToCommit(commitHash);
        if (data) {
          inventoryData = data.inventory || [];
          imageData = data.images || {};
          
          // 更新显示
          updateAllTables();
          saveToLocalStorage();
          
          alert('已恢复到指定版本');
        }
      } catch (error) {
        console.error('恢复失败:', error);
        alert('恢复失败: ' + error.message);
      }
    }
    
    function viewCommitDetails(commitHash) {
      if (!gitStorage) return;
      
      const commit = gitStorage.getCommitHistory().find(c => c.hash === commitHash);
      if (!commit) return;
      
      const details = `
提交哈希: ${commit.hash}
提交信息: ${commit.message}
提交时间: ${new Date(commit.timestamp).toLocaleString()}
数据大小: ${(JSON.stringify(commit.data).length / 1024).toFixed(2)} KB
库存项目数: ${commit.data.inventory ? commit.data.inventory.length : 0}
图片数量: ${commit.data.images ? Object.keys(commit.data.images).length : 0}
      `;
      
      alert(details);
    }
    
    function compareVersions() {
      const versionA = document.getElementById('versionA').value;
      const versionB = document.getElementById('versionB').value;
      
      if (!versionA || !versionB) {
        alert('请选择两个版本进行对比');
        return;
      }
      
      if (!gitStorage) return;
      
      try {
        const diff = gitStorage.getDiff(versionA, versionB);
        const diffContainer = document.getElementById('versionDiff');
        
        if (diff.length === 0) {
          diffContainer.innerHTML = '<p class="text-gray-500 text-center">两个版本没有差异</p>';
          return;
        }
        
        const diffHtml = diff.map(change => {
          const changeType = change.type === 'added' ? '新增' : 
                           change.type === 'removed' ? '删除' : '修改';
          const colorClass = change.type === 'added' ? 'text-green-600' : 
                           change.type === 'removed' ? 'text-red-600' : 'text-blue-600';
          
          return `
            <div class="border-l-4 border-${change.type === 'added' ? 'green' : change.type === 'removed' ? 'red' : 'blue'}-400 pl-4 py-2">
              <div class="font-medium ${colorClass}">${changeType}: ${change.field}</div>
              <div class="text-sm text-gray-600 mt-1">${change.description}</div>
            </div>
          `;
        }).join('');
        
        diffContainer.innerHTML = diffHtml;
      } catch (error) {
        console.error('版本对比失败:', error);
        alert('版本对比失败: ' + error.message);
      }
    }
    
    function exportGitRepo() {
      if (!gitStorage) {
        alert('Git存储系统未初始化');
        return;
      }
      
      try {
        const repoData = gitStorage.exportRepo();
        const blob = new Blob([JSON.stringify(repoData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `inventory-git-repo-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        alert('仓库导出成功!');
      } catch (error) {
        console.error('导出失败:', error);
        alert('导出失败: ' + error.message);
      }
    }
  </script>
  
  <!-- 数据恢复模态框 -->
  <div id="restoreModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-96">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">恢复数据</h3>
      <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center">
        <i class="fa fa-upload text-4xl text-gray-400 mb-4"></i>
        <p class="text-gray-600 mb-4">选择备份文件进行数据恢复</p>
        <input type="file" id="restoreFileInput" accept=".json" class="hidden" onchange="handleRestoreFile(event)">
        <button onclick="document.getElementById('restoreFileInput').click()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
          选择备份文件
        </button>
      </div>
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mt-4">
        <div class="flex items-start">
          <i class="fa fa-exclamation-triangle text-yellow-600 mr-2 mt-0.5"></i>
          <div class="text-sm text-yellow-800">
            <p class="font-medium mb-1">注意事项：</p>
            <ul class="list-disc list-inside space-y-1">
              <li>恢复操作将覆盖当前所有数据</li>
              <li>建议在恢复前先备份当前数据</li>
              <li>只能恢复本系统导出的备份文件</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="flex justify-end space-x-3 mt-6">
        <button onclick="closeRestoreModal()" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
          取消
        </button>
      </div>
    </div>
  </div>
  
  <script>
    
    // 页面加载完成后检查库的加载状态并初始化应用
    document.addEventListener('DOMContentLoaded', function() {
      // 检查XLSX库是否加载
      if (typeof XLSX === 'undefined') {
        console.error('XLSX库未加载');
        // 在页面顶部显示警告
        const warningDiv = document.createElement('div');
        warningDiv.innerHTML = `
          <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
            <strong class="font-bold">警告：</strong>
            <span class="block sm:inline">Excel处理功能不可用。请检查网络连接或刷新页面重试。</span>
          </div>
        `;
        const mainContent = document.querySelector('main');
        if (mainContent) {
          mainContent.insertBefore(warningDiv, mainContent.firstChild);
        }
      } else {
        console.log('XLSX库加载成功');
      }
      
      // 检查Chart.js库是否加载
      if (typeof Chart === 'undefined') {
        console.error('Chart.js库未加载');
      } else {
        console.log('Chart.js库加载成功');
      }
      
      // 初始化Git存储系统
      if (typeof GitStorage !== 'undefined') {
        const gitInitSuccess = initializeGitStorage();
        console.log('Git存储系统已初始化');
        
        // Git存储系统初始化完成后，再初始化应用
        setTimeout(() => {
          initializeApp();
        }, 100);
      } else {
        console.error('GitStorage类未加载');
        updateSyncStatus('Git存储不可用', 'error');
        
        // 即使Git存储不可用，也要初始化应用
        initializeApp();
      }
    });
  </script>
</body>
</html>